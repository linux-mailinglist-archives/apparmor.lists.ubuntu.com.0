Return-Path: <apparmor-bounces@lists.ubuntu.com>
X-Original-To: lists+apparmor@lfdr.de
Delivered-To: lists+apparmor@lfdr.de
Received: from huckleberry.canonical.com (huckleberry.canonical.com [91.189.94.19])
	by mail.lfdr.de (Postfix) with ESMTPS id BD1B146F65F
	for <lists+apparmor@lfdr.de>; Thu,  9 Dec 2021 23:02:11 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=huckleberry.canonical.com)
	by huckleberry.canonical.com with esmtp (Exim 4.86_2)
	(envelope-from <apparmor-bounces@lists.ubuntu.com>)
	id 1mvRUM-0000W1-3C; Thu, 09 Dec 2021 22:02:06 +0000
Received: from smtp-relay-internal-1.internal ([10.131.114.114]
 helo=smtp-relay-internal-1.canonical.com)
 by huckleberry.canonical.com with esmtps
 (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128) (Exim 4.86_2)
 (envelope-from <georgia.garcia@canonical.com>) id 1mvRUJ-0000Vu-Qx
 for apparmor@lists.ubuntu.com; Thu, 09 Dec 2021 22:02:03 +0000
Received: from mail-ua1-f71.google.com (mail-ua1-f71.google.com
 [209.85.222.71])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature RSA-PSS (2048 bits) server-digest SHA256)
 (No client certificate requested)
 by smtp-relay-internal-1.canonical.com (Postfix) with ESMTPS id A03083F1B7
 for <apparmor@lists.ubuntu.com>; Thu,  9 Dec 2021 22:02:03 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=canonical.com;
 s=20210705; t=1639087323;
 bh=YhoIdns8G3yNRjOkgk1gok3W1vh6PXK0r7AUleBcIjA=;
 h=From:To:Cc:Subject:Date:Message-Id:MIME-Version;
 b=PLepyt9JYje9IK49h3j3Jg3D/s4F5BvNOcQUbhNUJgG0pK0wyWFrIoGzVjI7YC8j/
 6JWqKKAZjdX0Kfq9Lhfgyx7dPhiSYRTV3jj0nZ8rakySJUdhGfe9xCb2CUSGiD4Zyx
 SQZ9LVfknb0xxchIdz0e3laHppimxA1nDk0OZu+jCCp4Hi8Y8TsWg15rGI8OGXdHWy
 c010IgqRRm9zQcAdsEyNzdEqU2p0NsFfxiwNUeipLJ+ZaBkP38jE2etMe9MDnz9kIH
 X2cFptmOCb/y4xzb0xxlKntbvCzcsw4Vo6b7euIynRN3p01k+GWP94a22y7dCIdPUi
 +bL7/ICY5ZwKw==
Received: by mail-ua1-f71.google.com with SMTP id
 b6-20020ab026c6000000b002e56ca72e19so4990326uap.7
 for <apparmor@lists.ubuntu.com>; Thu, 09 Dec 2021 14:02:03 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=YhoIdns8G3yNRjOkgk1gok3W1vh6PXK0r7AUleBcIjA=;
 b=6yva6uI6e5B/2LiTRO9scNXN7AMxtdSttPSCvnGMKPKAOvmvvCYHob63/giuOoK4Kj
 Z8ITN3892F1jzcNG0bg/5EdYNutqUK3cCYYrYvKYZ1Y+ktem0pD0oxUSIJ/+iFxbXck8
 4oPJq2iF4YcOfeXWiA3MjSqYmRlFl5flXgCglO1e3wqZ2Gh5sJVcxksdEKXhvUtQ/9f/
 JIoYGaHVLu3pNnHLxzfxRO6OwLFGBGQ4c6moshViWQwjlULBqJs8kJ6BDFJRrKYvWpx6
 ukW8vOII2rCFAE8VnfmoxftWQP8/ZWNErLxt8CJu1HJW0p5FvSmo16TgDhb7oqwFVEUi
 6fwQ==
X-Gm-Message-State: AOAM532wiYTbg/7lq7Y6iXYNVM/fr5LLghvJSy8wLdK9akbBzJniM8TR
 VVP27WsHIANirAAEJbW2hfDEQQvTM0HY0fbQDxuqH3JhdKqBVG7P9T8Bsk+JzDLpfvXo+AhKY97
 /U8y6ybd47G4DX031jn69f0YN6s0uxjXDUK4/Fw==
X-Received: by 2002:ab0:74c1:: with SMTP id f1mr22931792uaq.109.1639087322382; 
 Thu, 09 Dec 2021 14:02:02 -0800 (PST)
X-Google-Smtp-Source: ABdhPJx318/i0m1B9zUl5pubw8ur+m8W8LbSPfZVZiQ9DW0OlDT4I4dbgan//+IJO7KcmXwzm2hZ2A==
X-Received: by 2002:ab0:74c1:: with SMTP id f1mr22931756uaq.109.1639087322001; 
 Thu, 09 Dec 2021 14:02:02 -0800 (PST)
Received: from localhost ([2804:431:c7ef:ece7:3818:b3a1:e2cd:ada7])
 by smtp.gmail.com with ESMTPSA id t20sm851256vsj.27.2021.12.09.14.02.01
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Thu, 09 Dec 2021 14:02:01 -0800 (PST)
From: Georgia Garcia <georgia.garcia@canonical.com>
To: apparmor@lists.ubuntu.com
Date: Thu,  9 Dec 2021 19:01:59 -0300
Message-Id: <20211209220159.51756-1-georgia.garcia@canonical.com>
X-Mailer: git-send-email 2.25.1
MIME-Version: 1.0
Subject: [apparmor] [PATCH v2] apparmor: add module mediation
X-BeenThere: apparmor@lists.ubuntu.com
X-Mailman-Version: 2.1.20
Precedence: list
List-Id: AppArmor discussion <apparmor.lists.ubuntu.com>
List-Unsubscribe: <https://lists.ubuntu.com/mailman/options/apparmor>,
 <mailto:apparmor-request@lists.ubuntu.com?subject=unsubscribe>
List-Archive: <https://lists.ubuntu.com/archives/apparmor>
List-Post: <mailto:apparmor@lists.ubuntu.com>
List-Help: <mailto:apparmor-request@lists.ubuntu.com?subject=help>
List-Subscribe: <https://lists.ubuntu.com/mailman/listinfo/apparmor>,
 <mailto:apparmor-request@lists.ubuntu.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: apparmor-bounces@lists.ubuntu.com
Sender: "AppArmor" <apparmor-bounces@lists.ubuntu.com>

UHJvdmlkZSBiYXNpYyBtZWRpYXRpb24gZm9yIG1vZHVsZSBsb2FkaW5nLgoKVGhlIHVzZXIgc3Bh
Y2UgcnVsZSBoYXMgdGhlIGZvbGxvd2luZyBmb3JtOgogICAgTU9EVUxFIFJVTEUgPSBbIFFVQUxJ
RklFUlMgXSAnbW9kdWxlJyBbIE1PREUgXQogICAgCSAgIAkgIFsgUEFUSCB8IE1PRFVMRSBOQU1F
IF0KCiAgICBNT0RFID0gKCAnbG9hZF9kYXRhJyB8ICdsb2FkX2ZpbGUnIHwgJ3JlcXVlc3QnICkK
CiAgICBQQVRIID0gcGF0aCB0byBsb2FkYWJsZSBrZXJuZWwgbW9kdWxlCgogICAgTU9EVUxFIE5B
TUUgPSBuYW1lIG9mIHRoZSBtb2R1bGUgdG8gYmUgcmVxdWVzdGVkIHRvIG1vZHByb2JlCgpTaWdu
ZWQtb2ZmLWJ5OiBHZW9yZ2lhIEdhcmNpYSA8Z2VvcmdpYS5nYXJjaWFAY2Fub25pY2FsLmNvbT4K
LS0tCnYyOiBSZXBsYWNlZCAlMCBieSAwIGluIGNvbW1lbnRzLCBhbmQgZml4ZWQgdHlwbyBpbiB0
aGUgY29tbWl0IG1lc3NhZ2UuCi0tLQogc2VjdXJpdHkvYXBwYXJtb3IvTWFrZWZpbGUgICAgICAg
ICAgIHwgICAzICstCiBzZWN1cml0eS9hcHBhcm1vci9hcHBhcm1vcmZzLmMgICAgICAgfCAgIDcg
Kwogc2VjdXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9hcHBhcm1vci5oIHwgICAzICstCiBzZWN1cml0
eS9hcHBhcm1vci9pbmNsdWRlL2F1ZGl0LmggICAgfCAgIDEgKwogc2VjdXJpdHkvYXBwYXJtb3Iv
aW5jbHVkZS9tb2R1bGUuaCAgIHwgIDI0ICsrKwogc2VjdXJpdHkvYXBwYXJtb3IvbHNtLmMgICAg
ICAgICAgICAgIHwgIDU2ICsrKysrKwogc2VjdXJpdHkvYXBwYXJtb3IvbW9kdWxlLmMgICAgICAg
ICAgIHwgMjY5ICsrKysrKysrKysrKysrKysrKysrKysrKysrKwogNyBmaWxlcyBjaGFuZ2VkLCAz
NjEgaW5zZXJ0aW9ucygrKSwgMiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzZWN1
cml0eS9hcHBhcm1vci9pbmNsdWRlL21vZHVsZS5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgc2VjdXJp
dHkvYXBwYXJtb3IvbW9kdWxlLmMKCmRpZmYgLS1naXQgYS9zZWN1cml0eS9hcHBhcm1vci9NYWtl
ZmlsZSBiL3NlY3VyaXR5L2FwcGFybW9yL01ha2VmaWxlCmluZGV4IGZmMjNmY2ZlZmUxOS4uOTMy
ZDYyMWJhNGI1IDEwMDY0NAotLS0gYS9zZWN1cml0eS9hcHBhcm1vci9NYWtlZmlsZQorKysgYi9z
ZWN1cml0eS9hcHBhcm1vci9NYWtlZmlsZQpAQCAtNSw3ICs1LDggQEAgb2JqLSQoQ09ORklHX1NF
Q1VSSVRZX0FQUEFSTU9SKSArPSBhcHBhcm1vci5vCiAKIGFwcGFybW9yLXkgOj0gYXBwYXJtb3Jm
cy5vIGF1ZGl0Lm8gY2FwYWJpbGl0eS5vIHRhc2subyBpcGMubyBsaWIubyBtYXRjaC5vIFwKICAg
ICAgICAgICAgICAgcGF0aC5vIGRvbWFpbi5vIHBvbGljeS5vIHBvbGljeV91bnBhY2subyBwcm9j
YXR0ci5vIGxzbS5vIFwKLSAgICAgICAgICAgICAgcmVzb3VyY2UubyBzZWNpZC5vIGZpbGUubyBw
b2xpY3lfbnMubyBsYWJlbC5vIG1vdW50Lm8gbmV0Lm8KKyAgICAgICAgICAgICAgcmVzb3VyY2Uu
byBzZWNpZC5vIGZpbGUubyBwb2xpY3lfbnMubyBsYWJlbC5vIG1vdW50Lm8gbmV0Lm8gXAorICAg
ICAgICAgICAgICBtb2R1bGUubwogYXBwYXJtb3ItJChDT05GSUdfU0VDVVJJVFlfQVBQQVJNT1Jf
SEFTSCkgKz0gY3J5cHRvLm8KIAogY2xlYW4tZmlsZXMgOj0gY2FwYWJpbGl0eV9uYW1lcy5oIHJs
aW1fbmFtZXMuaCBuZXRfbmFtZXMuaApkaWZmIC0tZ2l0IGEvc2VjdXJpdHkvYXBwYXJtb3IvYXBw
YXJtb3Jmcy5jIGIvc2VjdXJpdHkvYXBwYXJtb3IvYXBwYXJtb3Jmcy5jCmluZGV4IDJlZTNiM2Qy
OWYxMC4uZjM1OTc4YWQ1YzM0IDEwMDY0NAotLS0gYS9zZWN1cml0eS9hcHBhcm1vci9hcHBhcm1v
cmZzLmMKKysrIGIvc2VjdXJpdHkvYXBwYXJtb3IvYXBwYXJtb3Jmcy5jCkBAIC0yMzU3LDYgKzIz
NTcsMTIgQEAgc3RhdGljIHN0cnVjdCBhYV9zZnNfZW50cnkgYWFfc2ZzX2VudHJ5X3F1ZXJ5W10g
PSB7CiAJQUFfU0ZTX0RJUigibGFiZWwiLAkJCWFhX3Nmc19lbnRyeV9xdWVyeV9sYWJlbCksCiAJ
eyB9CiB9OworCitzdGF0aWMgc3RydWN0IGFhX3Nmc19lbnRyeSBhYV9zZnNfZW50cnlfbW9kdWxl
W10gPSB7CisJQUFfU0ZTX0ZJTEVfU1RSSU5HKCJtYXNrIiwgImxvYWRfZGF0YSBsb2FkX2ZpbGUg
cmVxdWVzdCIpLAorCXsgfQorfTsKKwogc3RhdGljIHN0cnVjdCBhYV9zZnNfZW50cnkgYWFfc2Zz
X2VudHJ5X2ZlYXR1cmVzW10gPSB7CiAJQUFfU0ZTX0RJUigicG9saWN5IiwJCQlhYV9zZnNfZW50
cnlfcG9saWN5KSwKIAlBQV9TRlNfRElSKCJkb21haW4iLAkJCWFhX3Nmc19lbnRyeV9kb21haW4p
LApAQCAtMjM3MCw2ICsyMzc2LDcgQEAgc3RhdGljIHN0cnVjdCBhYV9zZnNfZW50cnkgYWFfc2Zz
X2VudHJ5X2ZlYXR1cmVzW10gPSB7CiAJQUFfU0ZTX0RJUigicHRyYWNlIiwJCQlhYV9zZnNfZW50
cnlfcHRyYWNlKSwKIAlBQV9TRlNfRElSKCJzaWduYWwiLAkJCWFhX3Nmc19lbnRyeV9zaWduYWwp
LAogCUFBX1NGU19ESVIoInF1ZXJ5IiwJCQlhYV9zZnNfZW50cnlfcXVlcnkpLAorCUFBX1NGU19E
SVIoIm1vZHVsZSIsCQkJYWFfc2ZzX2VudHJ5X21vZHVsZSksCiAJeyB9CiB9OwogCmRpZmYgLS1n
aXQgYS9zZWN1cml0eS9hcHBhcm1vci9pbmNsdWRlL2FwcGFybW9yLmggYi9zZWN1cml0eS9hcHBh
cm1vci9pbmNsdWRlL2FwcGFybW9yLmgKaW5kZXggMWZiYWJkYjU2NWE4Li5jZjhiMzE1ZGZmZGMg
MTAwNjQ0Ci0tLSBhL3NlY3VyaXR5L2FwcGFybW9yL2luY2x1ZGUvYXBwYXJtb3IuaAorKysgYi9z
ZWN1cml0eS9hcHBhcm1vci9pbmNsdWRlL2FwcGFybW9yLmgKQEAgLTI4LDggKzI4LDkgQEAKICNk
ZWZpbmUgQUFfQ0xBU1NfU0lHTkFMCQkxMAogI2RlZmluZSBBQV9DTEFTU19ORVQJCTE0CiAjZGVm
aW5lIEFBX0NMQVNTX0xBQkVMCQkxNgorI2RlZmluZSBBQV9DTEFTU19NT0RVTEUgICAgICAgICAx
NwogCi0jZGVmaW5lIEFBX0NMQVNTX0xBU1QJCUFBX0NMQVNTX0xBQkVMCisjZGVmaW5lIEFBX0NM
QVNTX0xBU1QJCUFBX0NMQVNTX01PRFVMRQogCiAvKiBDb250cm9sIHBhcmFtZXRlcnMgc2V0dGFi
bGUgdGhyb3VnaCBtb2R1bGUvYm9vdCBmbGFncyAqLwogZXh0ZXJuIGVudW0gYXVkaXRfbW9kZSBh
YV9nX2F1ZGl0OwpkaWZmIC0tZ2l0IGEvc2VjdXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9hdWRpdC5o
IGIvc2VjdXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9hdWRpdC5oCmluZGV4IDE4NTE5YTRlYjY3ZS4u
MjIyZmRjMTg1NzliIDEwMDY0NAotLS0gYS9zZWN1cml0eS9hcHBhcm1vci9pbmNsdWRlL2F1ZGl0
LmgKKysrIGIvc2VjdXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9hdWRpdC5oCkBAIC0xMDMsNiArMTAz
LDcgQEAgZW51bSBhdWRpdF90eXBlIHsKICNkZWZpbmUgT1BfUFJPRl9MT0FEICJwcm9maWxlX2xv
YWQiCiAjZGVmaW5lIE9QX1BST0ZfUk0gInByb2ZpbGVfcmVtb3ZlIgogCisjZGVmaW5lIE9QX01P
RFVMRSAibW9kdWxlIgogCiBzdHJ1Y3QgYXBwYXJtb3JfYXVkaXRfZGF0YSB7CiAJaW50IGVycm9y
OwpkaWZmIC0tZ2l0IGEvc2VjdXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9tb2R1bGUuaCBiL3NlY3Vy
aXR5L2FwcGFybW9yL2luY2x1ZGUvbW9kdWxlLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXgg
MDAwMDAwMDAwMDAwLi41NzM3OGQ4YjVjYTIKLS0tIC9kZXYvbnVsbAorKysgYi9zZWN1cml0eS9h
cHBhcm1vci9pbmNsdWRlL21vZHVsZS5oCkBAIC0wLDAgKzEsMjQgQEAKKy8qIFNQRFgtTGljZW5z
ZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkgKi8KKy8qCisgKiBBcHBBcm1vciBzZWN1cml0eSBt
b2R1bGUKKyAqCisgKiBUaGlzIGZpbGUgY29udGFpbnMgQXBwQXJtb3IgbW9kdWxlIG1lZGlhdGlv
biBmdW5jdGlvbiBkZWZpbml0aW9ucy4KKyAqCisgKiBDb3B5cmlnaHQgMjAyMSBDYW5vbmljYWwg
THRkLgorICovCisKKyNpZm5kZWYgX19BQV9NT0RVTEVfSAorI2RlZmluZSBfX0FBX01PRFVMRV9I
CisKKyNkZWZpbmUgQUFfTUFZX0xPQURfREFUQQlBQV9NQVlfV1JJVEUKKyNkZWZpbmUgQUFfTUFZ
X0xPQURfRklMRQlBQV9NQVlfQ1JFQVRFCisjZGVmaW5lIEFBX01BWV9SRVFVRVNUCQlBQV9NQVlf
QVBQRU5ECisjZGVmaW5lIEFBX1ZBTElEX01PRFVMRV9QRVJNUyAoQUFfTUFZX0xPQURfREFUQSB8
IEFBX01BWV9MT0FEX0ZJTEUgfCBcCisJCQkgICAgICAgQUFfTUFZX1JFUVVFU1QpCisKK2ludCBh
YV9tb2R1bGVfZnJvbV9maWxlKHN0cnVjdCBhYV9sYWJlbCAqbGFiZWwsIHN0cnVjdCBmaWxlICpm
aWxlLAorCQkJdTMyIHJlcXVlc3QpOworaW50IGFhX21vZHVsZV9mcm9tX25hbWUoc3RydWN0IGFh
X2xhYmVsICpsYWJlbCwgY2hhciAqbmFtZSwKKwkJCXUzMiByZXF1ZXN0LCBpbnQgZGF0YV90eXBl
KTsKKworI2VuZGlmIC8qIF9fQUFfTU9EVUxFX0ggKi8KZGlmZiAtLWdpdCBhL3NlY3VyaXR5L2Fw
cGFybW9yL2xzbS5jIGIvc2VjdXJpdHkvYXBwYXJtb3IvbHNtLmMKaW5kZXggZjcyNDA2ZmUxYmYy
Li4wNmQ2M2M4ZDdkZTcgMTAwNjQ0Ci0tLSBhL3NlY3VyaXR5L2FwcGFybW9yL2xzbS5jCisrKyBi
L3NlY3VyaXR5L2FwcGFybW9yL2xzbS5jCkBAIC0zOCw2ICszOCw3IEBACiAjaW5jbHVkZSAiaW5j
bHVkZS9wb2xpY3kuaCIKICNpbmNsdWRlICJpbmNsdWRlL3BvbGljeV9ucy5oIgogI2luY2x1ZGUg
ImluY2x1ZGUvcHJvY2F0dHIuaCIKKyNpbmNsdWRlICJpbmNsdWRlL21vZHVsZS5oIgogI2luY2x1
ZGUgImluY2x1ZGUvbW91bnQuaCIKICNpbmNsdWRlICJpbmNsdWRlL3NlY2lkLmgiCiAKQEAgLTEx
NjksNiArMTE3MCw1NyBAQCBzdGF0aWMgaW50IGFwcGFybW9yX2luZXRfY29ubl9yZXF1ZXN0KGNv
bnN0IHN0cnVjdCBzb2NrICpzaywgc3RydWN0IHNrX2J1ZmYgKnNrYgogfQogI2VuZGlmCiAKK3N0
YXRpYyBpbnQgYXBwYXJtb3Jfa2VybmVsX21vZHVsZV9yZXF1ZXN0KGNoYXIgKmttb2RfbmFtZSkK
K3sKKwlzdHJ1Y3QgYWFfbGFiZWwgKmxhYmVsOworCWludCBlcnJvciA9IDA7CisKKwlsYWJlbCA9
IF9fYmVnaW5fY3VycmVudF9sYWJlbF9jcml0X3NlY3Rpb24oKTsKKwllcnJvciA9IGFhX21vZHVs
ZV9mcm9tX25hbWUobGFiZWwsIGttb2RfbmFtZSwgQUFfTUFZX1JFUVVFU1QsIExTTV9BVURJVF9E
QVRBX0tNT0QpOworCV9fZW5kX2N1cnJlbnRfbGFiZWxfY3JpdF9zZWN0aW9uKGxhYmVsKTsKKwor
CXJldHVybiBlcnJvcjsKK30KKworc3RhdGljIGludCBhcHBhcm1vcl9rZXJuZWxfbG9hZF9kYXRh
KGVudW0ga2VybmVsX2xvYWRfZGF0YV9pZCBpZCwKKwkJCQkgICAgIGJvb2wgY29udGVudHMpCit7
CisJc3RydWN0IGFhX2xhYmVsICpsYWJlbDsKKwlpbnQgZXJyb3IgPSAwOworCisJc3dpdGNoIChp
ZCkgeworCWNhc2UgTE9BRElOR19NT0RVTEU6CisJCWxhYmVsID0gX19iZWdpbl9jdXJyZW50X2xh
YmVsX2NyaXRfc2VjdGlvbigpOworCQllcnJvciA9IGFhX21vZHVsZV9mcm9tX25hbWUobGFiZWws
ICIiLCBBQV9NQVlfTE9BRF9EQVRBLCBMU01fQVVESVRfREFUQV9OT05FKTsKKwkJX19lbmRfY3Vy
cmVudF9sYWJlbF9jcml0X3NlY3Rpb24obGFiZWwpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQli
cmVhazsKKwl9CisKKwlyZXR1cm4gZXJyb3I7Cit9CisKK3N0YXRpYyBpbnQgYXBwYXJtb3Jfa2Vy
bmVsX3JlYWRfZmlsZShzdHJ1Y3QgZmlsZSAqZmlsZSwKKwkJCQkgICAgIGVudW0ga2VybmVsX3Jl
YWRfZmlsZV9pZCBpZCwKKwkJCQkgICAgIGJvb2wgY29udGVudHMpCit7CisJc3RydWN0IGFhX2xh
YmVsICpsYWJlbDsKKwlpbnQgZXJyb3IgPSAwOworCisJc3dpdGNoIChpZCkgeworCWNhc2UgUkVB
RElOR19NT0RVTEU6CisJCWxhYmVsID0gX19iZWdpbl9jdXJyZW50X2xhYmVsX2NyaXRfc2VjdGlv
bigpOworCQllcnJvciA9IGFhX21vZHVsZV9mcm9tX2ZpbGUobGFiZWwsIGNvbnRlbnRzID8gZmls
ZSA6IE5VTEwsIEFBX01BWV9MT0FEX0ZJTEUpOworCQlfX2VuZF9jdXJyZW50X2xhYmVsX2NyaXRf
c2VjdGlvbihsYWJlbCk7CisJCWJyZWFrOworCWRlZmF1bHQ6CisJCWJyZWFrOworCX0KKworCXJl
dHVybiBlcnJvcjsKK30KKwogLyoKICAqIFRoZSBjcmVkIGJsb2IgaXMgYSBwb2ludGVyIHRvLCBu
b3QgYW4gaW5zdGFuY2Ugb2YsIGFuIGFhX3Rhc2tfY3R4LgogICovCkBAIC0xMjY3LDYgKzEzMTks
MTAgQEAgc3RhdGljIHN0cnVjdCBzZWN1cml0eV9ob29rX2xpc3QgYXBwYXJtb3JfaG9va3NbXSBf
X2xzbV9yb19hZnRlcl9pbml0ID0gewogCUxTTV9IT09LX0lOSVQoc2VjaWRfdG9fc2VjY3R4LCBh
cHBhcm1vcl9zZWNpZF90b19zZWNjdHgpLAogCUxTTV9IT09LX0lOSVQoc2VjY3R4X3RvX3NlY2lk
LCBhcHBhcm1vcl9zZWNjdHhfdG9fc2VjaWQpLAogCUxTTV9IT09LX0lOSVQocmVsZWFzZV9zZWNj
dHgsIGFwcGFybW9yX3JlbGVhc2Vfc2VjY3R4KSwKKworCUxTTV9IT09LX0lOSVQoa2VybmVsX21v
ZHVsZV9yZXF1ZXN0LCBhcHBhcm1vcl9rZXJuZWxfbW9kdWxlX3JlcXVlc3QpLAorCUxTTV9IT09L
X0lOSVQoa2VybmVsX2xvYWRfZGF0YSwgYXBwYXJtb3Jfa2VybmVsX2xvYWRfZGF0YSksCisJTFNN
X0hPT0tfSU5JVChrZXJuZWxfcmVhZF9maWxlLCBhcHBhcm1vcl9rZXJuZWxfcmVhZF9maWxlKSwK
IH07CiAKIC8qCmRpZmYgLS1naXQgYS9zZWN1cml0eS9hcHBhcm1vci9tb2R1bGUuYyBiL3NlY3Vy
aXR5L2FwcGFybW9yL21vZHVsZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAw
MDAwMC4uODM3MDZmYTU3M2FhCi0tLSAvZGV2L251bGwKKysrIGIvc2VjdXJpdHkvYXBwYXJtb3Iv
bW9kdWxlLmMKQEAgLTAsMCArMSwyNjkgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBH
UEwtMi4wLW9ubHkKKy8qCisgKiBBcHBBcm1vciBzZWN1cml0eSBtb2R1bGUKKyAqCisgKiBUaGlz
IGZpbGUgY29udGFpbnMgQXBwQXJtb3IgbW9kdWxlIG1lZGlhdGlvbgorICoKKyAqIENvcHlyaWdo
dCAyMDIxIENhbm9uaWNhbCBMdGQuCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2dmcC5oPgorI2lu
Y2x1ZGUgPGxpbnV4L3BhdGguaD4KKworI2luY2x1ZGUgImluY2x1ZGUvYXVkaXQuaCIKKyNpbmNs
dWRlICJpbmNsdWRlL21vZHVsZS5oIgorI2luY2x1ZGUgImluY2x1ZGUvcGF0aC5oIgorI2luY2x1
ZGUgImluY2x1ZGUvcG9saWN5LmgiCisKKy8qKgorICogYXVkaXRfbW9kdWxlX21hc2sgLSBjb252
ZXJ0IG1hc2sgdG8gcGVybWlzc2lvbiBzdHJpbmcKKyAqIEBtYXNrOiBwZXJtaXNzaW9uIG1hc2sg
dG8gY29udmVydAorICoKKyAqIFJldHVybnM6IHBvaW50ZXIgdG8gc3RhdGljIHN0cmluZworICov
CitzdGF0aWMgY29uc3QgY2hhciAqYXVkaXRfbW9kdWxlX21hc2sodTMyIG1hc2spCit7CisJc3dp
dGNoIChtYXNrKSB7CisJY2FzZSBBQV9NQVlfTE9BRF9EQVRBOgorCQlyZXR1cm4gImxvYWRfZGF0
YSI7CisJY2FzZSBBQV9NQVlfTE9BRF9GSUxFOgorCQlyZXR1cm4gImxvYWRfZmlsZSI7CisJY2Fz
ZSBBQV9NQVlfUkVRVUVTVDoKKwkJcmV0dXJuICJyZXF1ZXN0IjsKKwl9CisJcmV0dXJuICIiOwor
fQorCisvKiBjYWxsYmFjayB0byBhdWRpdCBtb2R1bGUgZmllbGRzICovCitzdGF0aWMgdm9pZCBh
dWRpdF9tb2R1bGVfY2Ioc3RydWN0IGF1ZGl0X2J1ZmZlciAqYWIsIHZvaWQgKnZhKQoreworCXN0
cnVjdCBjb21tb25fYXVkaXRfZGF0YSAqc2EgPSB2YTsKKworCWlmIChhYWQoc2EpLT5yZXF1ZXN0
ICYgQUFfVkFMSURfTU9EVUxFX1BFUk1TKSB7CisJCWF1ZGl0X2xvZ19mb3JtYXQoYWIsICIgcmVx
dWVzdGVkX21hc2s9XCIlc1wiIiwKKwkJCQkgYXVkaXRfbW9kdWxlX21hc2soYWFkKHNhKS0+cmVx
dWVzdCkpOworCisJCWlmIChhYWQoc2EpLT5kZW5pZWQgJiBBQV9WQUxJRF9NT0RVTEVfUEVSTVMp
IHsKKwkJCWF1ZGl0X2xvZ19mb3JtYXQoYWIsICIgZGVuaWVkX21hc2s9XCIlc1wiIiwKKwkJCQkJ
IGF1ZGl0X21vZHVsZV9tYXNrKGFhZChzYSktPmRlbmllZCkpOworCQl9CisJfQorfQorCisvKioK
KyAqIGF1ZGl0X21vZHVsZSAtIGhhbmRsZSB0aGUgYXVkaXRpbmcgb2YgbW9kdWxlIG9wZXJhdGlv
bnMKKyAqIEBwcm9maWxlOiB0aGUgcHJvZmlsZSBiZWluZyBlbmZvcmNlZCAgKE5PVCBOVUxMKQor
ICogQHBlcm1zOiB0aGUgcGVybWlzc2lvbnMgY29tcHV0ZWQgZm9yIHRoZSByZXF1ZXN0IChOT1Qg
TlVMTCkKKyAqIEByZXF1ZXN0OiBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQKKyAqIEBuYW1lOiBuYW1l
IG9mIG9iamVjdCBiZWluZyBtZWRpYXRlZCAoTUFZIEJFIE5VTEwpCisgKiBAaW5mbzogZXh0cmEg
aW5mb3JtYXRpb24gbWVzc2FnZSAoTUFZIEJFIE5VTEwpCisgKiBAZXJyb3I6IDAgaWYgb3BlcmF0
aW9uIGFsbG93ZWQgZWxzZSBmYWlsdXJlIGVycm9yIGNvZGUKKyAqIEBkYXRhX3R5cGU6IGF1ZGl0
IGRhdGEgdHlwZQorICoKKyAqIFJldHVybnM6IDAgb3IgZXJyb3Igb24gZmFpbHVyZQorICovCitz
dGF0aWMgaW50IGF1ZGl0X21vZHVsZShzdHJ1Y3QgYWFfcHJvZmlsZSAqcHJvZmlsZSwgc3RydWN0
IGFhX3Blcm1zICpwZXJtcywKKwkJCXUzMiByZXF1ZXN0LCBjb25zdCBjaGFyICpuYW1lLCBjb25z
dCBjaGFyICppbmZvLAorCQkJaW50IGVycm9yLCBpbnQgZGF0YV90eXBlKQoreworCWludCB0eXBl
ID0gQVVESVRfQVBQQVJNT1JfQVVUTzsKKwlERUZJTkVfQVVESVRfREFUQShzYSwgZGF0YV90eXBl
LCBPUF9NT0RVTEUpOworCisJaWYgKGxpa2VseSghZXJyb3IpKSB7CisJCXUzMiBtYXNrID0gcGVy
bXMtPmF1ZGl0OworCisJCWlmICh1bmxpa2VseShBVURJVF9NT0RFKHByb2ZpbGUpID09IEFVRElU
X0FMTCkpCisJCQltYXNrID0gMHhmZmZmOworCisJCS8qIG1hc2sgb2ZmIHBlcm1zIHRoYXQgYXJl
IG5vdCBiZWluZyBmb3JjZSBhdWRpdGVkICovCisJCXJlcXVlc3QgJj0gbWFzazsKKworCQlpZiAo
bGlrZWx5KCFyZXF1ZXN0KSkKKwkJCXJldHVybiAwOworCQl0eXBlID0gQVVESVRfQVBQQVJNT1Jf
QVVESVQ7CisJfSBlbHNlIHsKKwkJLyogb25seSByZXBvcnQgcGVybWlzc2lvbnMgdGhhdCB3ZXJl
IGRlbmllZCAqLworCQlyZXF1ZXN0ID0gcmVxdWVzdCAmIH5wZXJtcy0+YWxsb3c7CisKKwkJaWYg
KHJlcXVlc3QgJiBwZXJtcy0+a2lsbCkKKwkJCXR5cGUgPSBBVURJVF9BUFBBUk1PUl9LSUxMOwor
CisJCS8qIHF1aWV0IGtub3duIHJlamVjdHMsIGFzc3VtZXMgcXVpZXQgYW5kIGtpbGwgZG8gbm90
IG92ZXJsYXAgKi8KKwkJaWYgKChyZXF1ZXN0ICYgcGVybXMtPnF1aWV0KSAmJgorCQkgICAgQVVE
SVRfTU9ERShwcm9maWxlKSAhPSBBVURJVF9OT1FVSUVUICYmCisJCSAgICBBVURJVF9NT0RFKHBy
b2ZpbGUpICE9IEFVRElUX0FMTCkKKwkJCXJlcXVlc3QgJj0gfnBlcm1zLT5xdWlldDsKKworCQlp
ZiAoIXJlcXVlc3QpCisJCQlyZXR1cm4gZXJyb3I7CisJfQorCisJYWFkKCZzYSktPnJlcXVlc3Qg
PSByZXF1ZXN0OworCWFhZCgmc2EpLT5uYW1lID0gbmFtZTsKKwlhYWQoJnNhKS0+aW5mbyA9IGlu
Zm87CisJYWFkKCZzYSktPmVycm9yID0gZXJyb3I7CisJYWFkKCZzYSktPmRlbmllZCA9IGFhZCgm
c2EpLT5yZXF1ZXN0ICYgfnBlcm1zLT5hbGxvdzsKKworCXJldHVybiBhYV9hdWRpdCh0eXBlLCBw
cm9maWxlLCAmc2EsIGF1ZGl0X21vZHVsZV9jYik7Cit9CisKKworLyoqCisgKiBjb21wdXRlX21v
ZHVsZV9wZXJtcyAtIGNvbXB1dGUgbW9kdWxlIHBlcm1pc3Npb24gYXNzb2NpYXRlZCB3aXRoIEBz
dGF0ZQorICogQGRmYTogZGZhIHRvIG1hdGNoIGFnYWluc3QgKE5PVCBOVUxMKQorICogQHN0YXRl
OiBzdGF0ZSBtYXRjaCBmaW5pc2hlZCBpbgorICoKKyAqIFJldHVybnM6IG1vZHVsZSBwZXJtaXNz
aW9ucworICovCitzdGF0aWMgc3RydWN0IGFhX3Blcm1zIGNvbXB1dGVfbW9kdWxlX3Blcm1zKHN0
cnVjdCBhYV9kZmEgKmRmYSwKKwkJCQkJICAgIHVuc2lnbmVkIGludCBzdGF0ZSkKK3sKKwlzdHJ1
Y3QgYWFfcGVybXMgcGVybXMgPSB7CisJCS5hbGxvdyA9IGRmYV91c2VyX2FsbG93KGRmYSwgc3Rh
dGUpLAorCQkuYXVkaXQgPSBkZmFfdXNlcl9hdWRpdChkZmEsIHN0YXRlKSwKKwkJLnF1aWV0ID0g
ZGZhX3VzZXJfcXVpZXQoZGZhLCBzdGF0ZSksCisJCS54aW5kZXggPSBkZmFfdXNlcl94aW5kZXgo
ZGZhLCBzdGF0ZSksCisJfTsKKworCXJldHVybiBwZXJtczsKK30KKworCisvKioKKyAqIGF1ZGl0
X21vZHVsZSAtIGhhbmRsZSB0aGUgYXVkaXRpbmcgb2YgbW9kdWxlIG9wZXJhdGlvbnMKKyAqIEBw
cm9maWxlOiB0aGUgcHJvZmlsZSBiZWluZyBlbmZvcmNlZCAgKE5PVCBOVUxMKQorICogQHBlcm1z
OiB0aGUgcGVybWlzc2lvbnMgY29tcHV0ZWQgZm9yIHRoZSByZXF1ZXN0IChOT1QgTlVMTCkKKyAq
IEByZXF1ZXN0OiBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQKKyAqIEBuYW1lOiBuYW1lIG9mIG9iamVj
dCBiZWluZyBtZWRpYXRlZCAoTUFZIEJFIE5VTEwpCisgKiBAaW5mbzogZXh0cmEgaW5mb3JtYXRp
b24gbWVzc2FnZSAoTUFZIEJFIE5VTEwpCisgKiBAZXJyb3I6IDAgaWYgb3BlcmF0aW9uIGFsbG93
ZWQgZWxzZSBmYWlsdXJlIGVycm9yIGNvZGUKKyAqIEBkYXRhX3R5cGU6IGF1ZGl0IGRhdGEgdHlw
ZQorICoKKyAqIFJldHVybnM6IDAgb3IgZXJyb3Igb24gZmFpbHVyZQorICovCitzdGF0aWMgaW50
IG1vZHVsZV9wZXJtKHN0cnVjdCBhYV9wcm9maWxlICpwcm9maWxlLAorCQkgICAgICAgY29uc3Qg
Y2hhciAqbmFtZSwgdTMyIHJlcXVlc3QsCisJCSAgICAgICBpbnQgZGF0YV90eXBlKQoreworCWlu
dCBlcnJvciA9IDA7CisJc3RydWN0IGFhX3Blcm1zIHBlcm1zID0geyB9OworCXVuc2lnbmVkIGlu
dCBzdGF0ZTsKKworCWlmIChwcm9maWxlX3VuY29uZmluZWQocHJvZmlsZSkpCisJCXJldHVybiAw
OworCisJaWYgKCFQUk9GSUxFX01FRElBVEVTKHByb2ZpbGUsIEFBX0NMQVNTX01PRFVMRSkpCisJ
CXJldHVybiAwOworCisJc3RhdGUgPSBhYV9kZmFfbWF0Y2gocHJvZmlsZS0+cG9saWN5LmRmYSwK
KwkJCSAgICAgcHJvZmlsZS0+cG9saWN5LnN0YXJ0W0FBX0NMQVNTX01PRFVMRV0sCisJCQkgICAg
IG5hbWUpOworCXBlcm1zID0gY29tcHV0ZV9tb2R1bGVfcGVybXMocHJvZmlsZS0+cG9saWN5LmRm
YSwgc3RhdGUpOworCisJaWYgKHJlcXVlc3QgJiB+cGVybXMuYWxsb3cpCisJCWVycm9yID0gLUVB
Q0NFUzsKKworCXJldHVybiBhdWRpdF9tb2R1bGUocHJvZmlsZSwgJnBlcm1zLCByZXF1ZXN0LCBu
YW1lLCBOVUxMLAorCQkJICAgIGVycm9yLCBkYXRhX3R5cGUpOworfQorCitzdGF0aWMgaW50IHBh
dGhfbW9kdWxlX3Blcm0oc3RydWN0IGFhX3Byb2ZpbGUgKnByb2ZpbGUsCisJCQkgICAgY29uc3Qg
c3RydWN0IHBhdGggKnBhdGgsCisJCQkgICAgY2hhciAqYnVmZmVyLCB1MzIgcmVxdWVzdCkKK3sK
Kwljb25zdCBjaGFyICpuYW1lOworCWNvbnN0IGNoYXIgKmluZm8gPSBOVUxMOworCWludCBlcnJv
cjsKKworCWlmIChwcm9maWxlX3VuY29uZmluZWQocHJvZmlsZSkpCisJCXJldHVybiAwOworCisJ
ZXJyb3IgPSBhYV9wYXRoX25hbWUocGF0aCwgcHJvZmlsZS0+cGF0aF9mbGFncywgYnVmZmVyLCAm
bmFtZSwgJmluZm8sCisJCQkgICAgIGxhYmVsc19wcm9maWxlKCZwcm9maWxlLT5sYWJlbCktPmRp
c2Nvbm5lY3RlZCk7CisKKwlpZiAoZXJyb3IpIHsKKwkJcmV0dXJuIGF1ZGl0X21vZHVsZShwcm9m
aWxlLCAmbnVsbHBlcm1zLCByZXF1ZXN0LCBuYW1lLCBpbmZvLAorCQkJCSAgICBlcnJvciwgTFNN
X0FVRElUX0RBVEFfTk9ORSk7CisJfQorCisJcmV0dXJuIG1vZHVsZV9wZXJtKHByb2ZpbGUsIG5h
bWUsIHJlcXVlc3QsCisJCQkgICBMU01fQVVESVRfREFUQV9OT05FKTsKK30KKworLyoqCisgKiBh
YV9tb2R1bGVfZnJvbV9maWxlIC0gaGFuZGxlIG1vZHVsZSBsb2FkaW5nIHRocm91Z2ggYSBmaWxl
CisgKiBAbGFiZWw6IGxhYmVsIGJlaW5nIGVuZm9yY2VkICAoTk9UIE5VTEwpCisgKiBAZmlsZTog
ZmlsZSB0byB2YWxpZGF0ZSBsb2FkaW5nIHBlcm1pc3Npb25zIG9uIChNQVkgQkUgTlVMTCkKKyAq
IEByZXF1ZXN0OiBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQKKyAqCisgKiBSZXR1cm5zOiAwIG9yIGVy
cm9yIG9uIGZhaWx1cmUKKyAqLworaW50IGFhX21vZHVsZV9mcm9tX2ZpbGUoc3RydWN0IGFhX2xh
YmVsICpsYWJlbCwgc3RydWN0IGZpbGUgKmZpbGUsCisJCQl1MzIgcmVxdWVzdCkKK3sKKwlpbnQg
ZXJyb3IgPSAwOworCXN0cnVjdCBhYV9wcm9maWxlICpwcm9maWxlOworCWNoYXIgKmJ1ZmZlcjsK
KworCWlmICh1bmNvbmZpbmVkKGxhYmVsKSkgeworCQlnb3RvIGRvbmU7CisJfQorCisJaWYgKCFm
aWxlKSB7CisJCWVycm9yID0gLUVQRVJNOworCQllcnJvciA9IGZuX2Zvcl9lYWNoKGxhYmVsLCBw
cm9maWxlLAorCQkJCSAgICBhdWRpdF9tb2R1bGUocHJvZmlsZSwgJm51bGxwZXJtcywKKwkJCQkJ
CSByZXF1ZXN0LCBOVUxMLCBOVUxMLAorCQkJCQkJIGVycm9yLCBMU01fQVVESVRfREFUQV9OT05F
KSk7CisJCWdvdG8gZG9uZTsKKwl9CisKKwlidWZmZXIgPSBhYV9nZXRfYnVmZmVyKGZhbHNlKTsK
KwlpZiAoIWJ1ZmZlcikKKwkJcmV0dXJuIC1FTk9NRU07CisKKwllcnJvciA9IGZuX2Zvcl9lYWNo
KGxhYmVsLCBwcm9maWxlLAorCQkJICAgIHBhdGhfbW9kdWxlX3Blcm0ocHJvZmlsZSwKKwkJCQkJ
ICAgICAmZmlsZS0+Zl9wYXRoLAorCQkJCQkgICAgIGJ1ZmZlciwgcmVxdWVzdCkpOworCWFhX3B1
dF9idWZmZXIoYnVmZmVyKTsKK2RvbmU6CisJcmV0dXJuIGVycm9yOworfQorCisKK3N0YXRpYyBp
bnQgbmFtZV9tb2R1bGVfcGVybShzdHJ1Y3QgYWFfcHJvZmlsZSAqcHJvZmlsZSwKKwkJCSAgICBj
aGFyICpuYW1lLCB1MzIgcmVxdWVzdCwgaW50IGRhdGFfdHlwZSkKK3sKKwlpZiAocHJvZmlsZV91
bmNvbmZpbmVkKHByb2ZpbGUpKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBtb2R1bGVfcGVybShw
cm9maWxlLCBuYW1lLCByZXF1ZXN0LAorCQkJICAgZGF0YV90eXBlKTsKK30KKworLyoqCisgKiBh
YV9tb2R1bGVfZnJvbV9maWxlIC0gaGFuZGxlIG1vZHVsZSBsb2FkaW5nIHRocm91Z2ggYSBmaWxl
CisgKiBAbGFiZWw6IGxhYmVsIGJlaW5nIGVuZm9yY2VkICAoTk9UIE5VTEwpCisgKiBAbmFtZTog
bmFtZSBvZiBvYmplY3QgYmVpbmcgbWVkaWF0ZWQKKyAqIEByZXF1ZXN0OiBwZXJtaXNzaW9ucyBy
ZXF1ZXN0ZWQKKyAqIEBkYXRhX3R5cGU6IGF1ZGl0IGRhdGEgdHlwZQorICoKKyAqIFJldHVybnM6
IDAgb3IgZXJyb3Igb24gZmFpbHVyZQorICovCitpbnQgYWFfbW9kdWxlX2Zyb21fbmFtZShzdHJ1
Y3QgYWFfbGFiZWwgKmxhYmVsLCBjaGFyICpuYW1lLAorCQkJdTMyIHJlcXVlc3QsIGludCBkYXRh
X3R5cGUpCit7CisJc3RydWN0IGFhX3Byb2ZpbGUgKnByb2ZpbGU7CisJaW50IGVycm9yID0gMDsK
KworCWlmICh1bmNvbmZpbmVkKGxhYmVsKSkgeworCQlnb3RvIGRvbmU7CisJfQorCisJZXJyb3Ig
PSBmbl9mb3JfZWFjaChsYWJlbCwgcHJvZmlsZSwKKwkJCSAgICBuYW1lX21vZHVsZV9wZXJtKHBy
b2ZpbGUsIG5hbWUsCisJCQkJCSAgICAgcmVxdWVzdCwgZGF0YV90eXBlKSk7Citkb25lOgorCXJl
dHVybiBlcnJvcjsKK30KLS0gCjIuMjUuMQoKCi0tIApBcHBBcm1vciBtYWlsaW5nIGxpc3QKQXBw
QXJtb3JAbGlzdHMudWJ1bnR1LmNvbQpNb2RpZnkgc2V0dGluZ3Mgb3IgdW5zdWJzY3JpYmUgYXQ6
IGh0dHBzOi8vbGlzdHMudWJ1bnR1LmNvbS9tYWlsbWFuL2xpc3RpbmZvL2FwcGFybW9yCg==
