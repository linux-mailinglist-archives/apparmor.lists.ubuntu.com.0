Return-Path: <apparmor-bounces@lists.ubuntu.com>
X-Original-To: lists+apparmor@lfdr.de
Delivered-To: lists+apparmor@lfdr.de
Received: from huckleberry.canonical.com (huckleberry.canonical.com [91.189.94.19])
	by mail.lfdr.de (Postfix) with ESMTPS id 8729546AB18
	for <lists+apparmor@lfdr.de>; Mon,  6 Dec 2021 22:55:35 +0100 (CET)
Received: from localhost ([127.0.0.1] helo=huckleberry.canonical.com)
	by huckleberry.canonical.com with esmtp (Exim 4.86_2)
	(envelope-from <apparmor-bounces@lists.ubuntu.com>)
	id 1muLxD-00079m-7Z; Mon, 06 Dec 2021 21:55:23 +0000
Received: from smtp-relay-internal-1.internal ([10.131.114.114]
 helo=smtp-relay-internal-1.canonical.com)
 by huckleberry.canonical.com with esmtps
 (TLS1.2:ECDHE_RSA_AES_128_GCM_SHA256:128) (Exim 4.86_2)
 (envelope-from <georgia.garcia@canonical.com>) id 1muLxA-00079f-Hz
 for apparmor@lists.ubuntu.com; Mon, 06 Dec 2021 21:55:20 +0000
Received: from mail-ua1-f71.google.com (mail-ua1-f71.google.com
 [209.85.222.71])
 (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
 key-exchange X25519 server-signature RSA-PSS (2048 bits) server-digest SHA256)
 (No client certificate requested)
 by smtp-relay-internal-1.canonical.com (Postfix) with ESMTPS id 50ACD3F1AF
 for <apparmor@lists.ubuntu.com>; Mon,  6 Dec 2021 21:55:20 +0000 (UTC)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=canonical.com;
 s=20210705; t=1638827720;
 bh=ecG+tcIzur4P5jivAB0372VnSBnPtCWqPUAcNon/myg=;
 h=From:To:Cc:Subject:Date:Message-Id:MIME-Version;
 b=t17jvPiV1exMx2AvXpiMzaz/XXzG+pqza+BDYU55VCWd2EymdNOmeYDqcYeCX6Muh
 SNxceiimIMNiK6mtkq9uJ6sQ62+jjHcT9JxBfC1Ob/XvMaqvPHFJ0ElDu3hyIBVoif
 ZGPgr3TDZmI25liegZn8g8ym0vf8CYLzVAq7mVJpkjPZi4+0OOAelu4mB1Rd5mGNyQ
 /VsfXHr/QjWsul/oN+dYjFC7gX6gobRlPCF1HNED/3wKwwAerqEJrlSiY7inLDaSSV
 fF/zrRV1HlxY7kcWQHcpWRqb2MWRM1RqBrCNeNCm4vTEXiZJXtCM3Ije8i+7EeSMNS
 AFBry1OZhh6Kw==
Received: by mail-ua1-f71.google.com with SMTP id
 v21-20020ab06595000000b002eaca2328e8so6820078uam.11
 for <apparmor@lists.ubuntu.com>; Mon, 06 Dec 2021 13:55:20 -0800 (PST)
X-Google-DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
 d=1e100.net; s=20210112;
 h=x-gm-message-state:from:to:cc:subject:date:message-id:mime-version
 :content-transfer-encoding;
 bh=ecG+tcIzur4P5jivAB0372VnSBnPtCWqPUAcNon/myg=;
 b=6+H6mjA323tqweVey9Re8LOyOCGARYQ61ZFCsCnFu0kqxfZSgLY8JBsPbVJ08UA6/J
 mgPHTOey4GROcObm49xJuQzYxQiSm7dKEXz+NRQ8ZIrYAgZ1HPFVAak2bCxDJ0W6QNOT
 pWk+UbvE7xIW/9LGf58pa1Op1q8bKyZ3Uwqa1B3ddn7M1cJflUfaQzsY8hz2uykWIKbc
 XiHAfQLOEixtKCCXEbxvNaK5QnUg8A52Xyu5u6lWXsSxSASV0WkjtP/8rhXWQ/y0tOmu
 JMwJVxOGPDR/9vvvSZG6oGUmgoYlmMgHE0dg5lfXieZOiEls4zEUbh4BW9UoVRyBEQs8
 Qqyw==
X-Gm-Message-State: AOAM530Jy6VO+PQfziVvgrDhakFTRmlNdCguCZU4vwinM/y7JC7/NqHa
 9dEbU5//phOVGaI1IJVSBkkXOTV/JlZIYcjE/S2dUC5jDZ1ZdiAVmovDNNC8s3NFhJfcl9qR//r
 wPODO4h+9GespE37P/w6bXXgQxqjsStQjhKcfYQ==
X-Received: by 2002:ab0:29d3:: with SMTP id i19mr44085085uaq.75.1638827719033; 
 Mon, 06 Dec 2021 13:55:19 -0800 (PST)
X-Google-Smtp-Source: ABdhPJxh7JTJw0J3uTSkuhED6FHVirjTwBjhpP6eTvKDeSwmN8wWI4OmVLOH6pGEAIxFUVENazzbsQ==
X-Received: by 2002:ab0:29d3:: with SMTP id i19mr44085021uaq.75.1638827718635; 
 Mon, 06 Dec 2021 13:55:18 -0800 (PST)
Received: from localhost ([2804:431:c7ef:ece7:38a3:608d:5bfb:eeb8])
 by smtp.gmail.com with ESMTPSA id m3sm5166911vkf.35.2021.12.06.13.55.17
 (version=TLS1_3 cipher=TLS_AES_128_GCM_SHA256 bits=128/128);
 Mon, 06 Dec 2021 13:55:18 -0800 (PST)
From: Georgia Garcia <georgia.garcia@canonical.com>
To: apparmor@lists.ubuntu.com
Date: Mon,  6 Dec 2021 18:55:16 -0300
Message-Id: <20211206215516.274310-1-georgia.garcia@canonical.com>
X-Mailer: git-send-email 2.25.1
MIME-Version: 1.0
Subject: [apparmor] [PATCH] apparmor: add module mediation
X-BeenThere: apparmor@lists.ubuntu.com
X-Mailman-Version: 2.1.20
Precedence: list
List-Id: AppArmor discussion <apparmor.lists.ubuntu.com>
List-Unsubscribe: <https://lists.ubuntu.com/mailman/options/apparmor>,
 <mailto:apparmor-request@lists.ubuntu.com?subject=unsubscribe>
List-Archive: <https://lists.ubuntu.com/archives/apparmor>
List-Post: <mailto:apparmor@lists.ubuntu.com>
List-Help: <mailto:apparmor-request@lists.ubuntu.com?subject=help>
List-Subscribe: <https://lists.ubuntu.com/mailman/listinfo/apparmor>,
 <mailto:apparmor-request@lists.ubuntu.com?subject=subscribe>
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
Errors-To: apparmor-bounces@lists.ubuntu.com
Sender: "AppArmor" <apparmor-bounces@lists.ubuntu.com>

UHJvdmlkZSBiYXNpYyBtZWRpYXRpb24gZm9yIG1vZHVsZSBsb2FkaW5nLgoKVGhlIHVzZXIgc3Bh
Y2UgcnVsZSBoYXZlIHRoZSBmb2xsb3dpbmcgZm9ybToKICAgIE1PRFVMRSBSVUxFID0gWyBRVUFM
SUZJRVJTIF0gJ21vZHVsZScgWyBNT0RFIF0KICAgIAkgICAJICBbIFBBVEggfCBNT0RVTEUgTkFN
RSBdCgogICAgTU9ERSA9ICggJ2xvYWRfZGF0YScgfCAnbG9hZF9maWxlJyB8ICdyZXF1ZXN0JyAp
CgogICAgUEFUSCA9IHBhdGggdG8gbG9hZGFibGUga2VybmVsIG1vZHVsZQoKICAgIE1PRFVMRSBO
QU1FID0gbmFtZSBvZiB0aGUgbW9kdWxlIHRvIGJlIHJlcXVlc3RlZCB0byBtb2Rwcm9iZQoKU2ln
bmVkLW9mZi1ieTogR2VvcmdpYSBHYXJjaWEgPGdlb3JnaWEuZ2FyY2lhQGNhbm9uaWNhbC5jb20+
Ci0tLQogc2VjdXJpdHkvYXBwYXJtb3IvTWFrZWZpbGUgICAgICAgICAgIHwgICAzICstCiBzZWN1
cml0eS9hcHBhcm1vci9hcHBhcm1vcmZzLmMgICAgICAgfCAgIDcgKwogc2VjdXJpdHkvYXBwYXJt
b3IvaW5jbHVkZS9hcHBhcm1vci5oIHwgICAzICstCiBzZWN1cml0eS9hcHBhcm1vci9pbmNsdWRl
L2F1ZGl0LmggICAgfCAgIDEgKwogc2VjdXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9tb2R1bGUuaCAg
IHwgIDI0ICsrKwogc2VjdXJpdHkvYXBwYXJtb3IvbHNtLmMgICAgICAgICAgICAgIHwgIDU2ICsr
KysrKwogc2VjdXJpdHkvYXBwYXJtb3IvbW9kdWxlLmMgICAgICAgICAgIHwgMjY5ICsrKysrKysr
KysrKysrKysrKysrKysrKysrKwogNyBmaWxlcyBjaGFuZ2VkLCAzNjEgaW5zZXJ0aW9ucygrKSwg
MiBkZWxldGlvbnMoLSkKIGNyZWF0ZSBtb2RlIDEwMDY0NCBzZWN1cml0eS9hcHBhcm1vci9pbmNs
dWRlL21vZHVsZS5oCiBjcmVhdGUgbW9kZSAxMDA2NDQgc2VjdXJpdHkvYXBwYXJtb3IvbW9kdWxl
LmMKCmRpZmYgLS1naXQgYS9zZWN1cml0eS9hcHBhcm1vci9NYWtlZmlsZSBiL3NlY3VyaXR5L2Fw
cGFybW9yL01ha2VmaWxlCmluZGV4IGZmMjNmY2ZlZmUxOS4uOTMyZDYyMWJhNGI1IDEwMDY0NAot
LS0gYS9zZWN1cml0eS9hcHBhcm1vci9NYWtlZmlsZQorKysgYi9zZWN1cml0eS9hcHBhcm1vci9N
YWtlZmlsZQpAQCAtNSw3ICs1LDggQEAgb2JqLSQoQ09ORklHX1NFQ1VSSVRZX0FQUEFSTU9SKSAr
PSBhcHBhcm1vci5vCiAKIGFwcGFybW9yLXkgOj0gYXBwYXJtb3Jmcy5vIGF1ZGl0Lm8gY2FwYWJp
bGl0eS5vIHRhc2subyBpcGMubyBsaWIubyBtYXRjaC5vIFwKICAgICAgICAgICAgICAgcGF0aC5v
IGRvbWFpbi5vIHBvbGljeS5vIHBvbGljeV91bnBhY2subyBwcm9jYXR0ci5vIGxzbS5vIFwKLSAg
ICAgICAgICAgICAgcmVzb3VyY2UubyBzZWNpZC5vIGZpbGUubyBwb2xpY3lfbnMubyBsYWJlbC5v
IG1vdW50Lm8gbmV0Lm8KKyAgICAgICAgICAgICAgcmVzb3VyY2UubyBzZWNpZC5vIGZpbGUubyBw
b2xpY3lfbnMubyBsYWJlbC5vIG1vdW50Lm8gbmV0Lm8gXAorICAgICAgICAgICAgICBtb2R1bGUu
bwogYXBwYXJtb3ItJChDT05GSUdfU0VDVVJJVFlfQVBQQVJNT1JfSEFTSCkgKz0gY3J5cHRvLm8K
IAogY2xlYW4tZmlsZXMgOj0gY2FwYWJpbGl0eV9uYW1lcy5oIHJsaW1fbmFtZXMuaCBuZXRfbmFt
ZXMuaApkaWZmIC0tZ2l0IGEvc2VjdXJpdHkvYXBwYXJtb3IvYXBwYXJtb3Jmcy5jIGIvc2VjdXJp
dHkvYXBwYXJtb3IvYXBwYXJtb3Jmcy5jCmluZGV4IDA3OTdlZGIyZmIzZC4uOWYxMTFmZWQzMmE3
IDEwMDY0NAotLS0gYS9zZWN1cml0eS9hcHBhcm1vci9hcHBhcm1vcmZzLmMKKysrIGIvc2VjdXJp
dHkvYXBwYXJtb3IvYXBwYXJtb3Jmcy5jCkBAIC0yMzU2LDYgKzIzNTYsMTIgQEAgc3RhdGljIHN0
cnVjdCBhYV9zZnNfZW50cnkgYWFfc2ZzX2VudHJ5X3F1ZXJ5W10gPSB7CiAJQUFfU0ZTX0RJUigi
bGFiZWwiLAkJCWFhX3Nmc19lbnRyeV9xdWVyeV9sYWJlbCksCiAJeyB9CiB9OworCitzdGF0aWMg
c3RydWN0IGFhX3Nmc19lbnRyeSBhYV9zZnNfZW50cnlfbW9kdWxlW10gPSB7CisJQUFfU0ZTX0ZJ
TEVfU1RSSU5HKCJtYXNrIiwgImxvYWRfZGF0YSBsb2FkX2ZpbGUgcmVxdWVzdCIpLAorCXsgfQor
fTsKKwogc3RhdGljIHN0cnVjdCBhYV9zZnNfZW50cnkgYWFfc2ZzX2VudHJ5X2ZlYXR1cmVzW10g
PSB7CiAJQUFfU0ZTX0RJUigicG9saWN5IiwJCQlhYV9zZnNfZW50cnlfcG9saWN5KSwKIAlBQV9T
RlNfRElSKCJkb21haW4iLAkJCWFhX3Nmc19lbnRyeV9kb21haW4pLApAQCAtMjM2OSw2ICsyMzc1
LDcgQEAgc3RhdGljIHN0cnVjdCBhYV9zZnNfZW50cnkgYWFfc2ZzX2VudHJ5X2ZlYXR1cmVzW10g
PSB7CiAJQUFfU0ZTX0RJUigicHRyYWNlIiwJCQlhYV9zZnNfZW50cnlfcHRyYWNlKSwKIAlBQV9T
RlNfRElSKCJzaWduYWwiLAkJCWFhX3Nmc19lbnRyeV9zaWduYWwpLAogCUFBX1NGU19ESVIoInF1
ZXJ5IiwJCQlhYV9zZnNfZW50cnlfcXVlcnkpLAorCUFBX1NGU19ESVIoIm1vZHVsZSIsCQkJYWFf
c2ZzX2VudHJ5X21vZHVsZSksCiAJeyB9CiB9OwogCmRpZmYgLS1naXQgYS9zZWN1cml0eS9hcHBh
cm1vci9pbmNsdWRlL2FwcGFybW9yLmggYi9zZWN1cml0eS9hcHBhcm1vci9pbmNsdWRlL2FwcGFy
bW9yLmgKaW5kZXggMWZiYWJkYjU2NWE4Li5jZjhiMzE1ZGZmZGMgMTAwNjQ0Ci0tLSBhL3NlY3Vy
aXR5L2FwcGFybW9yL2luY2x1ZGUvYXBwYXJtb3IuaAorKysgYi9zZWN1cml0eS9hcHBhcm1vci9p
bmNsdWRlL2FwcGFybW9yLmgKQEAgLTI4LDggKzI4LDkgQEAKICNkZWZpbmUgQUFfQ0xBU1NfU0lH
TkFMCQkxMAogI2RlZmluZSBBQV9DTEFTU19ORVQJCTE0CiAjZGVmaW5lIEFBX0NMQVNTX0xBQkVM
CQkxNgorI2RlZmluZSBBQV9DTEFTU19NT0RVTEUgICAgICAgICAxNwogCi0jZGVmaW5lIEFBX0NM
QVNTX0xBU1QJCUFBX0NMQVNTX0xBQkVMCisjZGVmaW5lIEFBX0NMQVNTX0xBU1QJCUFBX0NMQVNT
X01PRFVMRQogCiAvKiBDb250cm9sIHBhcmFtZXRlcnMgc2V0dGFibGUgdGhyb3VnaCBtb2R1bGUv
Ym9vdCBmbGFncyAqLwogZXh0ZXJuIGVudW0gYXVkaXRfbW9kZSBhYV9nX2F1ZGl0OwpkaWZmIC0t
Z2l0IGEvc2VjdXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9hdWRpdC5oIGIvc2VjdXJpdHkvYXBwYXJt
b3IvaW5jbHVkZS9hdWRpdC5oCmluZGV4IDE4NTE5YTRlYjY3ZS4uMjIyZmRjMTg1NzliIDEwMDY0
NAotLS0gYS9zZWN1cml0eS9hcHBhcm1vci9pbmNsdWRlL2F1ZGl0LmgKKysrIGIvc2VjdXJpdHkv
YXBwYXJtb3IvaW5jbHVkZS9hdWRpdC5oCkBAIC0xMDMsNiArMTAzLDcgQEAgZW51bSBhdWRpdF90
eXBlIHsKICNkZWZpbmUgT1BfUFJPRl9MT0FEICJwcm9maWxlX2xvYWQiCiAjZGVmaW5lIE9QX1BS
T0ZfUk0gInByb2ZpbGVfcmVtb3ZlIgogCisjZGVmaW5lIE9QX01PRFVMRSAibW9kdWxlIgogCiBz
dHJ1Y3QgYXBwYXJtb3JfYXVkaXRfZGF0YSB7CiAJaW50IGVycm9yOwpkaWZmIC0tZ2l0IGEvc2Vj
dXJpdHkvYXBwYXJtb3IvaW5jbHVkZS9tb2R1bGUuaCBiL3NlY3VyaXR5L2FwcGFybW9yL2luY2x1
ZGUvbW9kdWxlLmgKbmV3IGZpbGUgbW9kZSAxMDA2NDQKaW5kZXggMDAwMDAwMDAwMDAwLi41NzM3
OGQ4YjVjYTIKLS0tIC9kZXYvbnVsbAorKysgYi9zZWN1cml0eS9hcHBhcm1vci9pbmNsdWRlL21v
ZHVsZS5oCkBAIC0wLDAgKzEsMjQgQEAKKy8qIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwt
Mi4wLW9ubHkgKi8KKy8qCisgKiBBcHBBcm1vciBzZWN1cml0eSBtb2R1bGUKKyAqCisgKiBUaGlz
IGZpbGUgY29udGFpbnMgQXBwQXJtb3IgbW9kdWxlIG1lZGlhdGlvbiBmdW5jdGlvbiBkZWZpbml0
aW9ucy4KKyAqCisgKiBDb3B5cmlnaHQgMjAyMSBDYW5vbmljYWwgTHRkLgorICovCisKKyNpZm5k
ZWYgX19BQV9NT0RVTEVfSAorI2RlZmluZSBfX0FBX01PRFVMRV9ICisKKyNkZWZpbmUgQUFfTUFZ
X0xPQURfREFUQQlBQV9NQVlfV1JJVEUKKyNkZWZpbmUgQUFfTUFZX0xPQURfRklMRQlBQV9NQVlf
Q1JFQVRFCisjZGVmaW5lIEFBX01BWV9SRVFVRVNUCQlBQV9NQVlfQVBQRU5ECisjZGVmaW5lIEFB
X1ZBTElEX01PRFVMRV9QRVJNUyAoQUFfTUFZX0xPQURfREFUQSB8IEFBX01BWV9MT0FEX0ZJTEUg
fCBcCisJCQkgICAgICAgQUFfTUFZX1JFUVVFU1QpCisKK2ludCBhYV9tb2R1bGVfZnJvbV9maWxl
KHN0cnVjdCBhYV9sYWJlbCAqbGFiZWwsIHN0cnVjdCBmaWxlICpmaWxlLAorCQkJdTMyIHJlcXVl
c3QpOworaW50IGFhX21vZHVsZV9mcm9tX25hbWUoc3RydWN0IGFhX2xhYmVsICpsYWJlbCwgY2hh
ciAqbmFtZSwKKwkJCXUzMiByZXF1ZXN0LCBpbnQgZGF0YV90eXBlKTsKKworI2VuZGlmIC8qIF9f
QUFfTU9EVUxFX0ggKi8KZGlmZiAtLWdpdCBhL3NlY3VyaXR5L2FwcGFybW9yL2xzbS5jIGIvc2Vj
dXJpdHkvYXBwYXJtb3IvbHNtLmMKaW5kZXggMGQ2NTg1MDU2ZjNkLi4wZDczM2E2NGNjN2MgMTAw
NjQ0Ci0tLSBhL3NlY3VyaXR5L2FwcGFybW9yL2xzbS5jCisrKyBiL3NlY3VyaXR5L2FwcGFybW9y
L2xzbS5jCkBAIC0zOCw2ICszOCw3IEBACiAjaW5jbHVkZSAiaW5jbHVkZS9wb2xpY3kuaCIKICNp
bmNsdWRlICJpbmNsdWRlL3BvbGljeV9ucy5oIgogI2luY2x1ZGUgImluY2x1ZGUvcHJvY2F0dHIu
aCIKKyNpbmNsdWRlICJpbmNsdWRlL21vZHVsZS5oIgogI2luY2x1ZGUgImluY2x1ZGUvbW91bnQu
aCIKICNpbmNsdWRlICJpbmNsdWRlL3NlY2lkLmgiCiAKQEAgLTExNjksNiArMTE3MCw1NyBAQCBz
dGF0aWMgaW50IGFwcGFybW9yX2luZXRfY29ubl9yZXF1ZXN0KGNvbnN0IHN0cnVjdCBzb2NrICpz
aywgc3RydWN0IHNrX2J1ZmYgKnNrYgogfQogI2VuZGlmCiAKK3N0YXRpYyBpbnQgYXBwYXJtb3Jf
a2VybmVsX21vZHVsZV9yZXF1ZXN0KGNoYXIgKmttb2RfbmFtZSkKK3sKKwlzdHJ1Y3QgYWFfbGFi
ZWwgKmxhYmVsOworCWludCBlcnJvciA9IDA7CisKKwlsYWJlbCA9IF9fYmVnaW5fY3VycmVudF9s
YWJlbF9jcml0X3NlY3Rpb24oKTsKKwllcnJvciA9IGFhX21vZHVsZV9mcm9tX25hbWUobGFiZWws
IGttb2RfbmFtZSwgQUFfTUFZX1JFUVVFU1QsIExTTV9BVURJVF9EQVRBX0tNT0QpOworCV9fZW5k
X2N1cnJlbnRfbGFiZWxfY3JpdF9zZWN0aW9uKGxhYmVsKTsKKworCXJldHVybiBlcnJvcjsKK30K
Kworc3RhdGljIGludCBhcHBhcm1vcl9rZXJuZWxfbG9hZF9kYXRhKGVudW0ga2VybmVsX2xvYWRf
ZGF0YV9pZCBpZCwKKwkJCQkgICAgIGJvb2wgY29udGVudHMpCit7CisJc3RydWN0IGFhX2xhYmVs
ICpsYWJlbDsKKwlpbnQgZXJyb3IgPSAwOworCisJc3dpdGNoIChpZCkgeworCWNhc2UgTE9BRElO
R19NT0RVTEU6CisJCWxhYmVsID0gX19iZWdpbl9jdXJyZW50X2xhYmVsX2NyaXRfc2VjdGlvbigp
OworCQllcnJvciA9IGFhX21vZHVsZV9mcm9tX25hbWUobGFiZWwsICIiLCBBQV9NQVlfTE9BRF9E
QVRBLCBMU01fQVVESVRfREFUQV9OT05FKTsKKwkJX19lbmRfY3VycmVudF9sYWJlbF9jcml0X3Nl
Y3Rpb24obGFiZWwpOworCQlicmVhazsKKwlkZWZhdWx0OgorCQlicmVhazsKKwl9CisKKwlyZXR1
cm4gZXJyb3I7Cit9CisKK3N0YXRpYyBpbnQgYXBwYXJtb3Jfa2VybmVsX3JlYWRfZmlsZShzdHJ1
Y3QgZmlsZSAqZmlsZSwKKwkJCQkgICAgIGVudW0ga2VybmVsX3JlYWRfZmlsZV9pZCBpZCwKKwkJ
CQkgICAgIGJvb2wgY29udGVudHMpCit7CisJc3RydWN0IGFhX2xhYmVsICpsYWJlbDsKKwlpbnQg
ZXJyb3IgPSAwOworCisJc3dpdGNoIChpZCkgeworCWNhc2UgUkVBRElOR19NT0RVTEU6CisJCWxh
YmVsID0gX19iZWdpbl9jdXJyZW50X2xhYmVsX2NyaXRfc2VjdGlvbigpOworCQllcnJvciA9IGFh
X21vZHVsZV9mcm9tX2ZpbGUobGFiZWwsIGNvbnRlbnRzID8gZmlsZSA6IE5VTEwsIEFBX01BWV9M
T0FEX0ZJTEUpOworCQlfX2VuZF9jdXJyZW50X2xhYmVsX2NyaXRfc2VjdGlvbihsYWJlbCk7CisJ
CWJyZWFrOworCWRlZmF1bHQ6CisJCWJyZWFrOworCX0KKworCXJldHVybiBlcnJvcjsKK30KKwog
LyoKICAqIFRoZSBjcmVkIGJsb2IgaXMgYSBwb2ludGVyIHRvLCBub3QgYW4gaW5zdGFuY2Ugb2Ys
IGFuIGFhX3Rhc2tfY3R4LgogICovCkBAIC0xMjY3LDYgKzEzMTksMTAgQEAgc3RhdGljIHN0cnVj
dCBzZWN1cml0eV9ob29rX2xpc3QgYXBwYXJtb3JfaG9va3NbXSBfX2xzbV9yb19hZnRlcl9pbml0
ID0gewogCUxTTV9IT09LX0lOSVQoc2VjaWRfdG9fc2VjY3R4LCBhcHBhcm1vcl9zZWNpZF90b19z
ZWNjdHgpLAogCUxTTV9IT09LX0lOSVQoc2VjY3R4X3RvX3NlY2lkLCBhcHBhcm1vcl9zZWNjdHhf
dG9fc2VjaWQpLAogCUxTTV9IT09LX0lOSVQocmVsZWFzZV9zZWNjdHgsIGFwcGFybW9yX3JlbGVh
c2Vfc2VjY3R4KSwKKworCUxTTV9IT09LX0lOSVQoa2VybmVsX21vZHVsZV9yZXF1ZXN0LCBhcHBh
cm1vcl9rZXJuZWxfbW9kdWxlX3JlcXVlc3QpLAorCUxTTV9IT09LX0lOSVQoa2VybmVsX2xvYWRf
ZGF0YSwgYXBwYXJtb3Jfa2VybmVsX2xvYWRfZGF0YSksCisJTFNNX0hPT0tfSU5JVChrZXJuZWxf
cmVhZF9maWxlLCBhcHBhcm1vcl9rZXJuZWxfcmVhZF9maWxlKSwKIH07CiAKIC8qCmRpZmYgLS1n
aXQgYS9zZWN1cml0eS9hcHBhcm1vci9tb2R1bGUuYyBiL3NlY3VyaXR5L2FwcGFybW9yL21vZHVs
ZS5jCm5ldyBmaWxlIG1vZGUgMTAwNjQ0CmluZGV4IDAwMDAwMDAwMDAwMC4uZGFkMmU5ZDhmYmJm
Ci0tLSAvZGV2L251bGwKKysrIGIvc2VjdXJpdHkvYXBwYXJtb3IvbW9kdWxlLmMKQEAgLTAsMCAr
MSwyNjkgQEAKKy8vIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBHUEwtMi4wLW9ubHkKKy8qCisg
KiBBcHBBcm1vciBzZWN1cml0eSBtb2R1bGUKKyAqCisgKiBUaGlzIGZpbGUgY29udGFpbnMgQXBw
QXJtb3IgbW9kdWxlIG1lZGlhdGlvbgorICoKKyAqIENvcHlyaWdodCAyMDIxIENhbm9uaWNhbCBM
dGQuCisgKi8KKworI2luY2x1ZGUgPGxpbnV4L2dmcC5oPgorI2luY2x1ZGUgPGxpbnV4L3BhdGgu
aD4KKworI2luY2x1ZGUgImluY2x1ZGUvYXVkaXQuaCIKKyNpbmNsdWRlICJpbmNsdWRlL21vZHVs
ZS5oIgorI2luY2x1ZGUgImluY2x1ZGUvcGF0aC5oIgorI2luY2x1ZGUgImluY2x1ZGUvcG9saWN5
LmgiCisKKy8qKgorICogYXVkaXRfbW9kdWxlX21hc2sgLSBjb252ZXJ0IG1hc2sgdG8gcGVybWlz
c2lvbiBzdHJpbmcKKyAqIEBtYXNrOiBwZXJtaXNzaW9uIG1hc2sgdG8gY29udmVydAorICoKKyAq
IFJldHVybnM6IHBvaW50ZXIgdG8gc3RhdGljIHN0cmluZworICovCitzdGF0aWMgY29uc3QgY2hh
ciAqYXVkaXRfbW9kdWxlX21hc2sodTMyIG1hc2spCit7CisJc3dpdGNoIChtYXNrKSB7CisJY2Fz
ZSBBQV9NQVlfTE9BRF9EQVRBOgorCQlyZXR1cm4gImxvYWRfZGF0YSI7CisJY2FzZSBBQV9NQVlf
TE9BRF9GSUxFOgorCQlyZXR1cm4gImxvYWRfZmlsZSI7CisJY2FzZSBBQV9NQVlfUkVRVUVTVDoK
KwkJcmV0dXJuICJyZXF1ZXN0IjsKKwl9CisJcmV0dXJuICIiOworfQorCisvKiBjYWxsYmFjayB0
byBhdWRpdCBtb2R1bGUgZmllbGRzICovCitzdGF0aWMgdm9pZCBhdWRpdF9tb2R1bGVfY2Ioc3Ry
dWN0IGF1ZGl0X2J1ZmZlciAqYWIsIHZvaWQgKnZhKQoreworCXN0cnVjdCBjb21tb25fYXVkaXRf
ZGF0YSAqc2EgPSB2YTsKKworCWlmIChhYWQoc2EpLT5yZXF1ZXN0ICYgQUFfVkFMSURfTU9EVUxF
X1BFUk1TKSB7CisJCWF1ZGl0X2xvZ19mb3JtYXQoYWIsICIgcmVxdWVzdGVkX21hc2s9XCIlc1wi
IiwKKwkJCQkgYXVkaXRfbW9kdWxlX21hc2soYWFkKHNhKS0+cmVxdWVzdCkpOworCisJCWlmIChh
YWQoc2EpLT5kZW5pZWQgJiBBQV9WQUxJRF9NT0RVTEVfUEVSTVMpIHsKKwkJCWF1ZGl0X2xvZ19m
b3JtYXQoYWIsICIgZGVuaWVkX21hc2s9XCIlc1wiIiwKKwkJCQkJIGF1ZGl0X21vZHVsZV9tYXNr
KGFhZChzYSktPmRlbmllZCkpOworCQl9CisJfQorfQorCisvKioKKyAqIGF1ZGl0X21vZHVsZSAt
IGhhbmRsZSB0aGUgYXVkaXRpbmcgb2YgbW9kdWxlIG9wZXJhdGlvbnMKKyAqIEBwcm9maWxlOiB0
aGUgcHJvZmlsZSBiZWluZyBlbmZvcmNlZCAgKE5PVCBOVUxMKQorICogQHBlcm1zOiB0aGUgcGVy
bWlzc2lvbnMgY29tcHV0ZWQgZm9yIHRoZSByZXF1ZXN0IChOT1QgTlVMTCkKKyAqIEByZXF1ZXN0
OiBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQKKyAqIEBuYW1lOiBuYW1lIG9mIG9iamVjdCBiZWluZyBt
ZWRpYXRlZCAoTUFZIEJFIE5VTEwpCisgKiBAaW5mbzogZXh0cmEgaW5mb3JtYXRpb24gbWVzc2Fn
ZSAoTUFZIEJFIE5VTEwpCisgKiBAZXJyb3I6IDAgaWYgb3BlcmF0aW9uIGFsbG93ZWQgZWxzZSBm
YWlsdXJlIGVycm9yIGNvZGUKKyAqIEBkYXRhX3R5cGU6IGF1ZGl0IGRhdGEgdHlwZQorICoKKyAq
IFJldHVybnM6ICUwIG9yIGVycm9yIG9uIGZhaWx1cmUKKyAqLworc3RhdGljIGludCBhdWRpdF9t
b2R1bGUoc3RydWN0IGFhX3Byb2ZpbGUgKnByb2ZpbGUsIHN0cnVjdCBhYV9wZXJtcyAqcGVybXMs
CisJCQl1MzIgcmVxdWVzdCwgY29uc3QgY2hhciAqbmFtZSwgY29uc3QgY2hhciAqaW5mbywKKwkJ
CWludCBlcnJvciwgaW50IGRhdGFfdHlwZSkKK3sKKwlpbnQgdHlwZSA9IEFVRElUX0FQUEFSTU9S
X0FVVE87CisJREVGSU5FX0FVRElUX0RBVEEoc2EsIGRhdGFfdHlwZSwgT1BfTU9EVUxFKTsKKwor
CWlmIChsaWtlbHkoIWVycm9yKSkgeworCQl1MzIgbWFzayA9IHBlcm1zLT5hdWRpdDsKKworCQlp
ZiAodW5saWtlbHkoQVVESVRfTU9ERShwcm9maWxlKSA9PSBBVURJVF9BTEwpKQorCQkJbWFzayA9
IDB4ZmZmZjsKKworCQkvKiBtYXNrIG9mZiBwZXJtcyB0aGF0IGFyZSBub3QgYmVpbmcgZm9yY2Ug
YXVkaXRlZCAqLworCQlyZXF1ZXN0ICY9IG1hc2s7CisKKwkJaWYgKGxpa2VseSghcmVxdWVzdCkp
CisJCQlyZXR1cm4gMDsKKwkJdHlwZSA9IEFVRElUX0FQUEFSTU9SX0FVRElUOworCX0gZWxzZSB7
CisJCS8qIG9ubHkgcmVwb3J0IHBlcm1pc3Npb25zIHRoYXQgd2VyZSBkZW5pZWQgKi8KKwkJcmVx
dWVzdCA9IHJlcXVlc3QgJiB+cGVybXMtPmFsbG93OworCisJCWlmIChyZXF1ZXN0ICYgcGVybXMt
PmtpbGwpCisJCQl0eXBlID0gQVVESVRfQVBQQVJNT1JfS0lMTDsKKworCQkvKiBxdWlldCBrbm93
biByZWplY3RzLCBhc3N1bWVzIHF1aWV0IGFuZCBraWxsIGRvIG5vdCBvdmVybGFwICovCisJCWlm
ICgocmVxdWVzdCAmIHBlcm1zLT5xdWlldCkgJiYKKwkJICAgIEFVRElUX01PREUocHJvZmlsZSkg
IT0gQVVESVRfTk9RVUlFVCAmJgorCQkgICAgQVVESVRfTU9ERShwcm9maWxlKSAhPSBBVURJVF9B
TEwpCisJCQlyZXF1ZXN0ICY9IH5wZXJtcy0+cXVpZXQ7CisKKwkJaWYgKCFyZXF1ZXN0KQorCQkJ
cmV0dXJuIGVycm9yOworCX0KKworCWFhZCgmc2EpLT5yZXF1ZXN0ID0gcmVxdWVzdDsKKwlhYWQo
JnNhKS0+bmFtZSA9IG5hbWU7CisJYWFkKCZzYSktPmluZm8gPSBpbmZvOworCWFhZCgmc2EpLT5l
cnJvciA9IGVycm9yOworCWFhZCgmc2EpLT5kZW5pZWQgPSBhYWQoJnNhKS0+cmVxdWVzdCAmIH5w
ZXJtcy0+YWxsb3c7CisKKwlyZXR1cm4gYWFfYXVkaXQodHlwZSwgcHJvZmlsZSwgJnNhLCBhdWRp
dF9tb2R1bGVfY2IpOworfQorCisKKy8qKgorICogY29tcHV0ZV9tb2R1bGVfcGVybXMgLSBjb21w
dXRlIG1vZHVsZSBwZXJtaXNzaW9uIGFzc29jaWF0ZWQgd2l0aCBAc3RhdGUKKyAqIEBkZmE6IGRm
YSB0byBtYXRjaCBhZ2FpbnN0IChOT1QgTlVMTCkKKyAqIEBzdGF0ZTogc3RhdGUgbWF0Y2ggZmlu
aXNoZWQgaW4KKyAqCisgKiBSZXR1cm5zOiBtb2R1bGUgcGVybWlzc2lvbnMKKyAqLworc3RhdGlj
IHN0cnVjdCBhYV9wZXJtcyBjb21wdXRlX21vZHVsZV9wZXJtcyhzdHJ1Y3QgYWFfZGZhICpkZmEs
CisJCQkJCSAgICB1bnNpZ25lZCBpbnQgc3RhdGUpCit7CisJc3RydWN0IGFhX3Blcm1zIHBlcm1z
ID0geworCQkuYWxsb3cgPSBkZmFfdXNlcl9hbGxvdyhkZmEsIHN0YXRlKSwKKwkJLmF1ZGl0ID0g
ZGZhX3VzZXJfYXVkaXQoZGZhLCBzdGF0ZSksCisJCS5xdWlldCA9IGRmYV91c2VyX3F1aWV0KGRm
YSwgc3RhdGUpLAorCQkueGluZGV4ID0gZGZhX3VzZXJfeGluZGV4KGRmYSwgc3RhdGUpLAorCX07
CisKKwlyZXR1cm4gcGVybXM7Cit9CisKKworLyoqCisgKiBhdWRpdF9tb2R1bGUgLSBoYW5kbGUg
dGhlIGF1ZGl0aW5nIG9mIG1vZHVsZSBvcGVyYXRpb25zCisgKiBAcHJvZmlsZTogdGhlIHByb2Zp
bGUgYmVpbmcgZW5mb3JjZWQgIChOT1QgTlVMTCkKKyAqIEBwZXJtczogdGhlIHBlcm1pc3Npb25z
IGNvbXB1dGVkIGZvciB0aGUgcmVxdWVzdCAoTk9UIE5VTEwpCisgKiBAcmVxdWVzdDogcGVybWlz
c2lvbnMgcmVxdWVzdGVkCisgKiBAbmFtZTogbmFtZSBvZiBvYmplY3QgYmVpbmcgbWVkaWF0ZWQg
KE1BWSBCRSBOVUxMKQorICogQGluZm86IGV4dHJhIGluZm9ybWF0aW9uIG1lc3NhZ2UgKE1BWSBC
RSBOVUxMKQorICogQGVycm9yOiAwIGlmIG9wZXJhdGlvbiBhbGxvd2VkIGVsc2UgZmFpbHVyZSBl
cnJvciBjb2RlCisgKiBAZGF0YV90eXBlOiBhdWRpdCBkYXRhIHR5cGUKKyAqCisgKiBSZXR1cm5z
OiAlMCBvciBlcnJvciBvbiBmYWlsdXJlCisgKi8KK3N0YXRpYyBpbnQgbW9kdWxlX3Blcm0oc3Ry
dWN0IGFhX3Byb2ZpbGUgKnByb2ZpbGUsCisJCSAgICAgICBjb25zdCBjaGFyICpuYW1lLCB1MzIg
cmVxdWVzdCwKKwkJICAgICAgIGludCBkYXRhX3R5cGUpCit7CisJaW50IGVycm9yID0gMDsKKwlz
dHJ1Y3QgYWFfcGVybXMgcGVybXMgPSB7IH07CisJdW5zaWduZWQgaW50IHN0YXRlOworCisJaWYg
KHByb2ZpbGVfdW5jb25maW5lZChwcm9maWxlKSkKKwkJcmV0dXJuIDA7CisKKwlpZiAoIVBST0ZJ
TEVfTUVESUFURVMocHJvZmlsZSwgQUFfQ0xBU1NfTU9EVUxFKSkKKwkJcmV0dXJuIDA7CisKKwlz
dGF0ZSA9IGFhX2RmYV9tYXRjaChwcm9maWxlLT5wb2xpY3kuZGZhLAorCQkJICAgICBwcm9maWxl
LT5wb2xpY3kuc3RhcnRbQUFfQ0xBU1NfTU9EVUxFXSwKKwkJCSAgICAgbmFtZSk7CisJcGVybXMg
PSBjb21wdXRlX21vZHVsZV9wZXJtcyhwcm9maWxlLT5wb2xpY3kuZGZhLCBzdGF0ZSk7CisKKwlp
ZiAocmVxdWVzdCAmIH5wZXJtcy5hbGxvdykKKwkJZXJyb3IgPSAtRUFDQ0VTOworCisJcmV0dXJu
IGF1ZGl0X21vZHVsZShwcm9maWxlLCAmcGVybXMsIHJlcXVlc3QsIG5hbWUsIE5VTEwsCisJCQkg
ICAgZXJyb3IsIGRhdGFfdHlwZSk7Cit9CisKK3N0YXRpYyBpbnQgcGF0aF9tb2R1bGVfcGVybShz
dHJ1Y3QgYWFfcHJvZmlsZSAqcHJvZmlsZSwKKwkJCSAgICBjb25zdCBzdHJ1Y3QgcGF0aCAqcGF0
aCwKKwkJCSAgICBjaGFyICpidWZmZXIsIHUzMiByZXF1ZXN0KQoreworCWNvbnN0IGNoYXIgKm5h
bWU7CisJY29uc3QgY2hhciAqaW5mbyA9IE5VTEw7CisJaW50IGVycm9yOworCisJaWYgKHByb2Zp
bGVfdW5jb25maW5lZChwcm9maWxlKSkKKwkJcmV0dXJuIDA7CisKKwllcnJvciA9IGFhX3BhdGhf
bmFtZShwYXRoLCBwcm9maWxlLT5wYXRoX2ZsYWdzLCBidWZmZXIsICZuYW1lLCAmaW5mbywKKwkJ
CSAgICAgbGFiZWxzX3Byb2ZpbGUoJnByb2ZpbGUtPmxhYmVsKS0+ZGlzY29ubmVjdGVkKTsKKwor
CWlmIChlcnJvcikgeworCQlyZXR1cm4gYXVkaXRfbW9kdWxlKHByb2ZpbGUsICZudWxscGVybXMs
IHJlcXVlc3QsIG5hbWUsIGluZm8sCisJCQkJICAgIGVycm9yLCBMU01fQVVESVRfREFUQV9OT05F
KTsKKwl9CisKKwlyZXR1cm4gbW9kdWxlX3Blcm0ocHJvZmlsZSwgbmFtZSwgcmVxdWVzdCwKKwkJ
CSAgIExTTV9BVURJVF9EQVRBX05PTkUpOworfQorCisvKioKKyAqIGFhX21vZHVsZV9mcm9tX2Zp
bGUgLSBoYW5kbGUgbW9kdWxlIGxvYWRpbmcgdGhyb3VnaCBhIGZpbGUKKyAqIEBsYWJlbDogbGFi
ZWwgYmVpbmcgZW5mb3JjZWQgIChOT1QgTlVMTCkKKyAqIEBmaWxlOiBmaWxlIHRvIHZhbGlkYXRl
IGxvYWRpbmcgcGVybWlzc2lvbnMgb24gKE1BWSBCRSBOVUxMKQorICogQHJlcXVlc3Q6IHBlcm1p
c3Npb25zIHJlcXVlc3RlZAorICoKKyAqIFJldHVybnM6ICUwIG9yIGVycm9yIG9uIGZhaWx1cmUK
KyAqLworaW50IGFhX21vZHVsZV9mcm9tX2ZpbGUoc3RydWN0IGFhX2xhYmVsICpsYWJlbCwgc3Ry
dWN0IGZpbGUgKmZpbGUsCisJCQl1MzIgcmVxdWVzdCkKK3sKKwlpbnQgZXJyb3IgPSAwOworCXN0
cnVjdCBhYV9wcm9maWxlICpwcm9maWxlOworCWNoYXIgKmJ1ZmZlcjsKKworCWlmICh1bmNvbmZp
bmVkKGxhYmVsKSkgeworCQlnb3RvIGRvbmU7CisJfQorCisJaWYgKCFmaWxlKSB7CisJCWVycm9y
ID0gLUVQRVJNOworCQllcnJvciA9IGZuX2Zvcl9lYWNoKGxhYmVsLCBwcm9maWxlLAorCQkJCSAg
ICBhdWRpdF9tb2R1bGUocHJvZmlsZSwgJm51bGxwZXJtcywKKwkJCQkJCSByZXF1ZXN0LCBOVUxM
LCBOVUxMLAorCQkJCQkJIGVycm9yLCBMU01fQVVESVRfREFUQV9OT05FKSk7CisJCWdvdG8gZG9u
ZTsKKwl9CisKKwlidWZmZXIgPSBhYV9nZXRfYnVmZmVyKGZhbHNlKTsKKwlpZiAoIWJ1ZmZlcikK
KwkJcmV0dXJuIC1FTk9NRU07CisKKwllcnJvciA9IGZuX2Zvcl9lYWNoKGxhYmVsLCBwcm9maWxl
LAorCQkJICAgIHBhdGhfbW9kdWxlX3Blcm0ocHJvZmlsZSwKKwkJCQkJICAgICAmZmlsZS0+Zl9w
YXRoLAorCQkJCQkgICAgIGJ1ZmZlciwgcmVxdWVzdCkpOworCWFhX3B1dF9idWZmZXIoYnVmZmVy
KTsKK2RvbmU6CisJcmV0dXJuIGVycm9yOworfQorCisKK3N0YXRpYyBpbnQgbmFtZV9tb2R1bGVf
cGVybShzdHJ1Y3QgYWFfcHJvZmlsZSAqcHJvZmlsZSwKKwkJCSAgICBjaGFyICpuYW1lLCB1MzIg
cmVxdWVzdCwgaW50IGRhdGFfdHlwZSkKK3sKKwlpZiAocHJvZmlsZV91bmNvbmZpbmVkKHByb2Zp
bGUpKQorCQlyZXR1cm4gMDsKKworCXJldHVybiBtb2R1bGVfcGVybShwcm9maWxlLCBuYW1lLCBy
ZXF1ZXN0LAorCQkJICAgZGF0YV90eXBlKTsKK30KKworLyoqCisgKiBhYV9tb2R1bGVfZnJvbV9m
aWxlIC0gaGFuZGxlIG1vZHVsZSBsb2FkaW5nIHRocm91Z2ggYSBmaWxlCisgKiBAbGFiZWw6IGxh
YmVsIGJlaW5nIGVuZm9yY2VkICAoTk9UIE5VTEwpCisgKiBAbmFtZTogbmFtZSBvZiBvYmplY3Qg
YmVpbmcgbWVkaWF0ZWQKKyAqIEByZXF1ZXN0OiBwZXJtaXNzaW9ucyByZXF1ZXN0ZWQKKyAqIEBk
YXRhX3R5cGU6IGF1ZGl0IGRhdGEgdHlwZQorICoKKyAqIFJldHVybnM6ICUwIG9yIGVycm9yIG9u
IGZhaWx1cmUKKyAqLworaW50IGFhX21vZHVsZV9mcm9tX25hbWUoc3RydWN0IGFhX2xhYmVsICps
YWJlbCwgY2hhciAqbmFtZSwKKwkJCXUzMiByZXF1ZXN0LCBpbnQgZGF0YV90eXBlKQoreworCXN0
cnVjdCBhYV9wcm9maWxlICpwcm9maWxlOworCWludCBlcnJvciA9IDA7CisKKwlpZiAodW5jb25m
aW5lZChsYWJlbCkpIHsKKwkJZ290byBkb25lOworCX0KKworCWVycm9yID0gZm5fZm9yX2VhY2go
bGFiZWwsIHByb2ZpbGUsCisJCQkgICAgbmFtZV9tb2R1bGVfcGVybShwcm9maWxlLCBuYW1lLAor
CQkJCQkgICAgIHJlcXVlc3QsIGRhdGFfdHlwZSkpOworZG9uZToKKwlyZXR1cm4gZXJyb3I7Cit9
Ci0tIAoyLjI1LjEKCgotLSAKQXBwQXJtb3IgbWFpbGluZyBsaXN0CkFwcEFybW9yQGxpc3RzLnVi
dW50dS5jb20KTW9kaWZ5IHNldHRpbmdzIG9yIHVuc3Vic2NyaWJlIGF0OiBodHRwczovL2xpc3Rz
LnVidW50dS5jb20vbWFpbG1hbi9saXN0aW5mby9hcHBhcm1vcgo=
